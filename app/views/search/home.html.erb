<provide(:title,'Recommendation')>
<h1>We recommend these restaurant for you:</h1>
<div>
	<form role="form" action='arestaurant'>
		<div class="form-group">
			<div class="col-xs-3">
				<input type="text" name = "name" class="form-control" placeholder="restaurant's name">
			</div>
		</div>
		<div class="form-group">
			<input type="submit" value="Search" class="btn btn-primary">
		</div>
	</form>
</div>
<div>
<% name = cookies[:username]%>
<%=name%>
<ul class="list-group">
<%
require 'moneta'
store=Moneta.new(:File, dir: 'moneta')
business_ids=[]
if store.key?(name)
	business_ids=store[name]
end

conn = OCI8.new('jackchen','cis5502015','jackdb.cipsboubatuq.us-east-1.rds.amazonaws.com:1521/TESTRDS')

len = business_ids.length


for i in 0..len-1

sql = "select business.name,business.full_address,business.city,state,stars from business where business_id=\'"+business_ids[i]+"\'"
%>

<% conn.exec(sql).fetch do |row|%>
<li class="list-group-item">
	Name:
<%= row[0] %>
<br>
	Address:
<%= row[1] %>
<br>
	City:
<%= row[2] %>
<br>
	State:
<%= row[3] %>
<br>
	Stars:
<%= row[4] %>
<br>
<%BingSearch.account_key='OQjobovJhpYgpIjDnC30TH/FOzw5Itq8eYTySpbfZGw'%>
<%result = BingSearch.image(row[0]).first %>
<%if result!=nil%>
<%= image_tag(result.media_url,:alt=>"Image",:title=>row[2],:height=>"100",:width=>"100")%>
<%end%>
</li>
<% end%>
<%end%>
</ul>
<%conn.logoff%>
</div>